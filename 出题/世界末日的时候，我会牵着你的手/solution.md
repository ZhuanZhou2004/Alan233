**世界末日的时候，我会牵着你的手**
 

对于一颗树,要使使得$[l, r]$区间的节点连通，则$[l,r]$区间的任意一对节点$(x, y)$的树上简单路径肯定是在连通块里面的~
 

所以有暴力做法：

枚举所有点对$(x,y)$，把其所在的书上简单路径找出来标记,最后统计有多少条边被标记了即可~

时间复杂度$O(q * n^3)$、$5$分到手

针对暴力做法，优化一下：

直接从$l$点出发，找出$l$到每一个点的简单路径标记，再统计标记的边数，也是可以的~

时间复杂度$O(q * n ^ 2)、5 - 9$分
 

正解做法：

有一个小结论，对于$[l,r]$节点的$dfs$序找出来，排序之后,假设是$A_1$至$A_{r-l+1}$序列.

答案就是：$\frac{\Sigma_{i = 1}^{r-l}{dist(Ai,Ai+1)}}{2} + 1$

当然，这样我们就可以通过预处理dist的值，时间复杂度变成了$O(qnlogn)$ 期望得分：$14-19$分

显然，这样也是$AC$不了的。

于是乎，我们通过带修莫队将在线查询转成离线的,新增一个节点，把原本的贡献删掉再加上新增的贡献即可，删除一个节点也同理~

所以我们的时间复杂度变成了$O(q\sqrt n logn)$